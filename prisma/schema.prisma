generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id             Int              @id @default(autoincrement())
  nombre         String           @unique
  correo         String           @unique
  contrasena     String
  rol            Rol              @default(Cliente)
  especialidad   String?          // Nueva columna para la especialidad
  citasCliente   Cita[]           @relation("citasCliente")
  citasMedico    Cita[]           @relation("citasMedico")
  disponibilidad Disponibilidad[]
  creadoEn       DateTime         @default(now())
  actualizadoEn  DateTime         @updatedAt
}


model Disponibilidad {
  id          Int        @id @default(autoincrement())
  medico      Usuario    @relation(fields: [medicoId], references: [id], onDelete: Cascade)
  medicoId    Int
  fecha       DateTime   @db.Date
  horaInicio  DateTime   @db.Time
  horaFin     DateTime   @db.Time
  citas       Cita[]     @relation("disponibilidadCitas")
}

model Cita {
  id                Int              @id @default(autoincrement())
  cliente           Usuario          @relation("citasCliente", fields: [clienteId], references: [id], onDelete: Cascade)
  clienteId         Int
  medico            Usuario          @relation("citasMedico", fields: [medicoId], references: [id], onDelete: Cascade)
  medicoId          Int
  disponibilidad    Disponibilidad?  @relation("disponibilidadCitas", fields: [disponibilidadId], references: [id], onDelete: SetNull)
  disponibilidadId  Int?
  fecha             DateTime         @db.Date
  hora              DateTime         @db.Time
  estado            EstadoCita
  historialCitas    HistorialCita[]
  creadoEn          DateTime         @default(now())
  actualizadoEn     DateTime         @updatedAt
}

model HistorialCita {
  id          Int       @id @default(autoincrement())
  cita        Cita      @relation(fields: [citaId], references: [id], onDelete: Cascade)
  citaId      Int
  accion      Accion
  fechaCambio DateTime  @default(now())
}

enum Rol {
  Administrador
  Medico
  Cliente
}

enum EstadoCita {
  Programada
  Cancelada
  Reprogramada
  Confirmada
}

enum Accion {
  Cancelada
  Reprogramada
}
